<template>
  <v-container>
    <v-row
      ><v-col xs="12" sm="12" md="8" lg="8" xl="8" xxl="8" cols="12">
        <ProjectRunner :type="project.type" :id="project.id" />
      </v-col>
      <v-col xs="12" sm="12" md="4" lg="4" xl="4" xxl="8" cols="12">
        <v-card hover border
          ><v-card-item>
            <v-card-title>{{ project.title }}</v-card-title>
            <v-card-subtitle>{{ project.description }}</v-card-subtitle>
          </v-card-item>
          <div class="px-4 d-flex ga-2 mb-2">
            <v-chip pill>
              <v-avatar start>
                <v-img
                  :src="
                    'https://s4-1.wuyuan.1r.ink/user/' + project.author.images
                  "
                ></v-img> </v-avatar
              >{{ project.author.display_name }}</v-chip
            >
          </div>
          <div class="px-4 d-flex ga-2 mb-2">
            <v-chip pill prepend-icon="mdi-eye"
              >{{ project.view_count }}浏览</v-chip
            >
            <v-chip pill prepend-icon="mdi-clock">
              <TimeAgo :date="project.time" />
            </v-chip>
          </div>
          <div class="px-4 d-flex ga-2 mb-2">
            <v-chip pill prepend-icon="mdi-xml" v-if="project.state == 'public'"
              >开源作品</v-chip
            >
            <v-chip
              pill
              prepend-icon="mdi-xml"
              v-if="project.state == 'private'"
              >私密作品</v-chip
            >

            <v-chip pill prepend-icon="mdi-application">{{
              project.type
            }}</v-chip>
          </div>
          <div class="px-4 d-flex ga-2 mb-2">
            <div v-for="tag in project.tags">
              <v-chip>{{ tag.name }}</v-chip>
            </div>
          </div>
          <div class="px-4 d-flex ga-2 mb-2">
            <v-btn @click="openEditor(project.id, project.type)" variant="text"
              >打开创造页</v-btn
            >
            <v-btn
              v-if="project.authorid != localuser.user.id"
              :to="'/projects/' + project.id + '/fork'"
              variant="text"
              >改编</v-btn
            >
          </div>

          <div class="px-4">
            <v-card hover :to="'/user/' + project.authorid" border>
              <v-card-item>
                <template v-slot:prepend>
                  <v-avatar>
                    <v-img
                      :alt="project.author.display_name"
                      :src="
                        'https://s4-1.wuyuan.1r.ink/user/' +
                        project.author.images
                      "
                    ></v-img>
                  </v-avatar>
                </template>
                <v-card-title class="text-white">
                  {{ project.author.display_name }}
                </v-card-title>
                <v-card-subtitle class="text-white">
                  {{ project.author.motto }}
                </v-card-subtitle>
              </v-card-item></v-card
            >
          </div>

          <br />
        </v-card>
        <br />
        <v-card hover border>
          <AddTolist></AddTolist>
        </v-card> </v-col
      ><v-col xxl="8" xl="8" lg="8" md="8" sm="12" xs="12" cols="12">
        <Comment :url="'project-' + $route.params.id" name="项目"></Comment>
      </v-col>
    </v-row>
  </v-container>
</template>

<script>
import openEditor from "../../../stores/openEdit";

import request from "../../../axios/axios";
import ProjectRunner from "../../../components/ProjectRunner.vue";
import { localuser } from "@/stores/user";
import AddTolist from "../../../components/AddTolist.vue";
import Comment from "../../../components/Comment.vue";
import TimeAgo from "@/components/TimeAgo.vue";
import { useHead } from "@unhead/vue";

export default {
  components: { ProjectRunner, TimeAgo, Comment, AddTolist },
  data() {
    return {
      project: {
        id: 1,
        authorid: 1,
        time: "2000-01-01T00:00:00.000Z",
        view_count: 0,
        like_count: 0,
        type: "text",
        favo_count: 0,
        title: "加载中",
        state: "public",
        description: "加载中",
        license: "MIT",
        tags: "",
        likeid: "",
        favoid: "",
        author: {
          id: 1,
          display_name: "加载中",
          images: "加载中",
        },
      },
      openEditor: openEditor,
      localuser: localuser,
    };
  },
  setup() {
    useHead({
      title: "项目",
    });
  },
  async created() {
    await this.getproject();
    //init({ el: "#waline", serverURL: "https://zerocat-waline.190823.xyz", path: "scratchproject-" + this.$route.params.id, copyright: false, reaction: true, pageview: true, locale: { reactionTitle: "这个作品怎么样？", }, emoji: [ "//unpkg.com/@waline/emojis@1.1.0/weibo", "//unpkg.com/@waline/emojis@1.1.0/bilibili", ], dark: window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches, });
  },
  methods: {
    async getproject() {
      this.project = await request({
        url: "/project/" + this.$route.params.id,
        method: "get",
      });
      useHead({
        title: "" + this.project.title,
      });
      console.log(this.project);
    },
  },
};
</script>
